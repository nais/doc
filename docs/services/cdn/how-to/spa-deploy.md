---
title: Deploy a Single Page Application
tags: [cdn, how-to, spa]
---

This how-to guide shows you how to deploy your Single Page Application (SPA) to the [CDN](../README.md) and NAIS without building and deploying a Docker image.

## Prerequisites

- A [NAIS team](../../../explanations/team.md).
- A GitHub repository that the team has access to.
- The application must build and package as a folder with an `index.html`, and its other static files.

## Limitations

- Versioning is not supported
- Clean-up of old static files are not supported
- Changing of app name is not supported

## Deploy with the SPA action

```yaml
name: Deploy SPA

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    permissions:
      contents: 'read'
      id-token: 'write'

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm ci
      - run: npm run build
      - uses: nais/deploy/actions/spa-deploy/v2@master
        with:
          app: my-frontend
          team: <team slug> # Required, e.g. "team-name"
{%- if tenant() == "nav" %}
          ingress: https://team.nav.no/my-frontend
{%- else %}
          tenant: <<tenant()>> # Required
          ingress: <<tenant_url("<env>", "my-frontend")>>
{%- endif %}
          source: <The path to your build folder or assets>
          environment: dev
          identity_provider: ${{ secrets.NAIS_WORKLOAD_IDENTITY_PROVIDER }} # Provided as Organization Secret
          project_id: ${{ vars.NAIS_MANAGEMENT_PROJECT_ID }} # Provided as Organization Variable
```

For more information on the inputs and outputs of the action, see the [SPA deploy action reference](../reference/spa-deploy.md).

The different values for `env` can be found under [Environments](../../../workloads/reference/environments.md).

Static files will be uploaded with the following CDN address:

```text
<<tenant_url("cdn", "<team>/<app>/<env>/")>>
```

### Multiple ingresses

If you want your app exposed on multiple ingresses you can use a comma separated list in the `ingress` field:

```yaml
- uses: nais/deploy/actions/spa-deploy/v2@master
  with:
    ...
{%- if tenant() != "nav" %}
    ingress: <<tenant_url("<env>", "my-frontend")>>, <<tenant_url("<env>", "my-other-ingress")>>
{%- else %}
    ingress: https://team.nav.no/my-frontend, https://team.nav.no/my-other-ingress
{%- endif %}
```

### Custom ingress

If you have your own domain that you want to host your SPA on, you need to supply the action with `ingressClass` and set the `environment`-field to the cluster you want to deploy to.

```yaml
- uses: nais/deploy/actions/spa-deploy/v2@master
  with:
    ...
    ingress: https://your-domain.no
    ingressClass: nais-ingress-external # Internal addresses should use "nais-ingress"
    environment: <env> # e.g. "prod-gcp"
```

## App configuration

### Create React App

To get the correct link in the static files generated by your Create React App you need to set the `PUBLIC_URL` variable.
This can be done in one of two ways:

- Either in a `.env` file:

```text
PUBLIC_URL=<<tenant_url("cdn", "<team>/<app>/<env>/")>>
```

- Or with an `env` in your GitHub Actions when you run `npm run build`:

```yaml
steps:
  - run: npm run build
    env:
      PUBLIC_URL=<<tenant_url("cdn", "<team>/<app>/<env>/")>>
```

* <https://create-react-app.dev/docs/advanced-configuration/>
* <https://create-react-app.dev/docs/adding-custom-environment-variables#adding-development-environment-variables-in-env>

### Next.js

You need to run `next export` and set `assetPrefix` in `next.config.js` when building a static Next.js application:

```js
const isProd = process.env.NODE_ENV === 'production'

module.exports = {
  // Use the CDN in production and localhost for development.
  assetPrefix: isProd ? '<<tenant_url("cdn", "<team>/<app>/<env>/")>>' : undefined,
}
```

- <https://nextjs.org/docs/api-reference/next.config.js/environment-variables>
- <https://nextjs.org/docs/api-reference/next.config.js/cdn-support-with-asset-prefix>
- <https://nextjs.org/docs/advanced-features/static-html-export>
